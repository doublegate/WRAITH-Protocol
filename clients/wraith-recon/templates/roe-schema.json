{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wraith-protocol.dev/schemas/roe-v1.json",
  "title": "WRAITH-Recon Rules of Engagement",
  "description": "Schema for WRAITH-Recon Rules of Engagement (RoE) documents. RoE documents define the authorized scope, timing, techniques, and constraints for security assessments.",
  "type": "object",
  "required": [
    "id",
    "version",
    "organization",
    "title",
    "authorized_operators",
    "start_time",
    "end_time",
    "signer_public_key",
    "signature"
  ],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for this RoE document. Recommended format: ROE-YYYY-TYPE-NNN",
      "pattern": "^[A-Za-z0-9_-]+$",
      "examples": ["ROE-2026-STD-001", "ROE-2026-RT-001"]
    },
    "version": {
      "type": "string",
      "description": "Document version. Use semantic versioning.",
      "pattern": "^[0-9]+\\.[0-9]+$",
      "default": "1.0",
      "examples": ["1.0", "1.1", "2.0"]
    },
    "organization": {
      "type": "string",
      "description": "Name of the organization conducting the assessment",
      "minLength": 1,
      "examples": ["Acme Security Consulting"]
    },
    "title": {
      "type": "string",
      "description": "Title of the engagement",
      "minLength": 1,
      "examples": ["Network Penetration Test - Q1 2026"]
    },
    "description": {
      "type": "string",
      "description": "Detailed description of the engagement scope and objectives",
      "default": "",
      "examples": ["Standard penetration testing engagement for network infrastructure assessment."]
    },
    "authorized_operators": {
      "type": "array",
      "description": "List of authorized operator identifiers (public key hashes or operator IDs)",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "examples": [["operator-001", "operator-002"]]
    },
    "client_name": {
      "type": "string",
      "description": "Name of the client organization being assessed",
      "default": "",
      "examples": ["Target Corporation"]
    },
    "start_time": {
      "type": "string",
      "format": "date-time",
      "description": "Engagement start time in RFC 3339 format (UTC recommended)",
      "examples": ["2026-01-24T09:00:00Z"]
    },
    "end_time": {
      "type": "string",
      "format": "date-time",
      "description": "Engagement end time in RFC 3339 format (UTC recommended)",
      "examples": ["2026-02-07T17:00:00Z"]
    },
    "authorized_cidrs": {
      "type": "array",
      "description": "List of authorized target networks in CIDR notation",
      "items": {
        "type": "string",
        "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}/[0-9]{1,2}$"
      },
      "default": [],
      "examples": [["192.168.1.0/24", "10.0.0.0/8"]]
    },
    "authorized_domains": {
      "type": "array",
      "description": "List of authorized target domains. Wildcards (*) are supported.",
      "items": {
        "type": "string"
      },
      "default": [],
      "examples": [["example.com", "*.staging.example.com"]]
    },
    "excluded_targets": {
      "type": "array",
      "description": "List of explicitly excluded targets (CIDRs or domains). These are always off-limits.",
      "items": {
        "type": "string"
      },
      "default": [],
      "examples": [["192.168.1.1/32", "prod.example.com"]]
    },
    "authorized_techniques": {
      "type": "array",
      "description": "List of authorized MITRE ATT&CK technique IDs. Empty array means all non-prohibited techniques are allowed.",
      "items": {
        "type": "string",
        "pattern": "^T[0-9]{4}(\\.[0-9]{3})?$"
      },
      "default": [],
      "examples": [["T1046", "T1040", "T1018"]]
    },
    "prohibited_techniques": {
      "type": "array",
      "description": "List of prohibited MITRE ATT&CK technique IDs. These are never allowed.",
      "items": {
        "type": "string",
        "pattern": "^T[0-9]{4}(\\.[0-9]{3})?$"
      },
      "default": [],
      "examples": [["T1486", "T1485", "T1561"]]
    },
    "max_exfil_rate": {
      "type": ["integer", "null"],
      "description": "Maximum data exfiltration rate in bytes per second. Null means no limit.",
      "minimum": 0,
      "examples": [10485760]
    },
    "max_exfil_total": {
      "type": ["integer", "null"],
      "description": "Maximum total data exfiltration in bytes. Null means no limit.",
      "minimum": 0,
      "examples": [1073741824]
    },
    "emergency_contacts": {
      "type": "array",
      "description": "List of emergency contacts for the engagement",
      "items": {
        "type": "object",
        "required": ["name", "role", "phone", "email"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Contact name"
          },
          "role": {
            "type": "string",
            "description": "Contact role (e.g., Security Director, SOC Lead)"
          },
          "phone": {
            "type": "string",
            "description": "Contact phone number"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Contact email address"
          }
        }
      },
      "default": []
    },
    "constraints": {
      "type": "array",
      "description": "Additional constraints and rules for the engagement",
      "items": {
        "type": "string"
      },
      "default": [],
      "examples": [["Testing only during business hours", "No denial of service attacks"]]
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Document creation timestamp in RFC 3339 format"
    },
    "signer_public_key": {
      "type": "string",
      "description": "Hex-encoded Ed25519 public key of the document signer (64 hex characters = 32 bytes)",
      "pattern": "^[a-fA-F0-9]{64}$"
    },
    "signature": {
      "type": "string",
      "description": "Hex-encoded Ed25519 signature of the document (128 hex characters = 64 bytes)",
      "pattern": "^[a-fA-F0-9]{128}$"
    }
  },
  "additionalProperties": false
}
